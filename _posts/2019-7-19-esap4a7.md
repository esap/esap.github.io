---
layout: post
title:  "ESAP4系列教程|最佳实践之路——章鱼模式"
categories: ESAP高级教程
tags:  ESAP ju nx AI 提醒 查询 章鱼模式 多库管理
---

* content
{:toc}

esap4.0的更新通常会伴随发布一个nxt示例库，导入这个库后，稍作修改就可以同时为多个应用进行服务，像一个八爪章鱼一样，这就是ESAP最佳实践经验之一的章鱼模式

## 注册其他库

登陆admin，在设置-数据库中开启其他应用库，例如：`pws`，`esapp1`等等。

![](/img/esap4a7-1.png)

## 多库提醒

把提醒模板单独导出导入到其他应用，在计划任务中设置相应的提醒，`任务ID`第一段设为该库的`数据源名`。

![](/img/esap4a7-2.png)

自定义提醒同理，额外添加后缀。

## 多库查询

修改查询，数据源填入其他库源名，模板函数后面也可以加入。

![](/img/esap4a7-3.png)

这样，查询结果，例如身份证信息就会存入其他数据库，而不是nxt库了。

> 记得先在其他库建立或导入模板用于承接数据。

## 多库API

自定义API的sql模板位于esap/sql/api2/，多库时，只要在请求URL上加个db参数即可。

例如：请求`http://esap:9090/api2/action?id=1`，会默认用`esap`库执行。

而请求`http://esap:9090/api2/action?id=1&db=pws`，就会用`pws`库执行。

## 小结

* 始终使用nxt库作为主库。

* 通过不同的配置，去操作其他应用库（NX/ES/金蝶/用友等）。

本文示例应用ESAP4.0.8+支持。

2019-07-19