---
layout: post
title:  "ESAP4系列教程|发票识别"
categories: ESAP高级教程
tags:  ESAP ju 慧表 nx AI 图片上传 发票识别
---

* content
{:toc}

ESAP4.0正式发布，一大波AI应用已来袭，巧的是这两天百度robin被泼冷水了，然后有了名言：

`AI前进的道路上会有各种各样想象不到的事情发生，但我们前行的决心不会改变`

## 客户需求

使用微信拍照或相册上传发票，直接存入ERP，并自动调用百度AI识别发票内容信息。

## 实现场景

首先，制作一个`【发票识别】`模板，上面放发票图，下面放各个字段，示例模板尽可能按图绘制。

![](/img/esap4a1-1.png)

该模板字段定义如下，发票可解析的主要内容基本都包含在内。

![](/img/esap4a1-2.png)

接下来，在企业微信应用中增加一个【采发票】菜单，`ID=cfp`，类型为：拍照或相册菜单

![](/img/esap4a-2.png)

建立一组esap查询，第一个查询由菜单(ID=cfp)发起，模式=2，表示新建表单模式，设置`下一步`，模板返回`正在识别，请稍后...`。

![](/img/esap4a1-3.png)

第二个查询如下，将用户发送的图片post给百度AI，结果赋值给$data，然后将其中的内容insert到发票识别模板的数据表中。

![](/img/esap4a1-4.png)

实际填报效果如下，在点击【采发票】菜单后，直接传图即可。

![](/img/esap4a1-5.png)

工作台自动生成了相应表单，爽得不要不要的。

![](/img/esap4a1-6.png)

## 技巧拓展

![](/img/esap4a1-7.png)

将查询下一步配置为`采发票-图片`本身，就可以实现连续传图了，输入`退出`可结束连续传图状态。

![](/img/esap4a1-8.jpg)

> esap4.0.4+支持

## 小结
本文示例应用需要启用Tokenserver。

本文示例应用ESAP4.0.0+支持，本文涉及的JU/NX数据库备份可在聚慧禅院中下载。

2019-07-03