---
layout: post
title:  "玩转ES锁状态"
categories: es秘籍
tags:  excel服务器 excelserver SQL 锁定 锁状态 
---

* content
{:toc}

![](/img/ess8-1.jpg)

很多时候我们应该对单据模板进行锁定条件设置，以防止被修改或全选误删。

## 结算后锁定
例如在月饼库中，入库单结算后锁定可以设置：`本表.结账日期 有值`
 
![](/img/ess8-2.jpg)

## 填报后马上锁定
很简单，可以设置：`1=1`
 
![](/img/ess8-3.jpg)
 
## 填报2小时后锁定
可以设置：`间隔时间(hh,系统变量.报表填报时间,系统变量.当前日期时间)>2`
 
![](/img/ess8-4.jpg)

## *检查其他模板表单锁定本模板表单。
例如：有t1、t2两个模板，当t1存在某个字段值(id)时，填报t2后锁定t2中对应的的单据。

* 先设置：`本表.id 属于 此集合(1)`

![](/img/ess8-5.jpg)
 
* 再修改数据库中ES_tmp中的LockExpSpec中的sql语句

![](/img/ess8-6.jpg) 
 
* 最终效果：

![](/img/ess8-7.jpg)

祝新年快乐！^_^  
