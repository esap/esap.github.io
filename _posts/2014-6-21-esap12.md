---
layout: post
title:  "ESAP第十二弹 订单批量导入和打印"
categories: esap中级
tags:  excel服务器 excelserver vba SAP ESAP 
---

* content
{:toc}

## 案例分析
* 这是一个稳定的供应链，客户使用SAP，超出产能的多余订单委外，以特定pdf形式发给其他工厂，其他工厂使用ES，接收代工订单导入ES并打印作业。
 
![](/img/esap12-1.jpg)

## 方案分析
* 由于架构不同，不进行数据对接。一般工厂会在收到pdf订单后由前台录入到ES，虽然pdf的文字可以复制粘贴，但是效率仍然不高。

* 方案设定：使用转换软件将pdf转换为EXCEL，然后通过VBA批量扫描导入ES。

![](/img/esap12-2.jpg)

## 订单批量导入过程
* 使用nitro pro完成转换。

![](/img/esap12-3.jpg)

![](/img/esap12-4.jpg)

`Pdf文件中有多个订单时，转换后的EXCEL会自动生成多个sheet，这非常棒！`

3.2设计专用ES模板，用VBA扫描EXCEL文件，读取关键字段数据并生成作业订单。
 
![](/img/esap12-5.jpg)

* 批量导入完成。
 
![](/img/esap12-6.jpg)

* 在作业订单模板设置工作流后，这些新建订单就会以待办形式出现，不直接下发，业务员审核办理每个订单再保存下发。
 
![](/img/esap12-7.jpg)
 
## 订单批量打印过程
* 打印模板的设计其实跟查询模板并无差别，使用表间公式，通过订单号等关键字段筛选显示订单数据，形成打印样表。

![](/img/esap12-8.jpg)
 
* 批量打印就是在打印模板的基础上，增加一个待打印列表（重复数据项），通过VBA循环扫描该列表，逐个发送订单号到打印样表，然后提数并输出到打印机。
 
![](/img/esap12-9.jpg)
 
## 应用拓展
* 批量打印时，可在开始阶段代码中加入打印机选择，这样更灵活。

参考代码：`Application.Dialogs(xlDialogPrinterSetup).Show`
  
![](/img/esap12-10.jpg)

* 批量打印时，可在结束阶段代码中加入重复打印选择，以便打印机出错时快速重复打印。

![](/img/esap12-11.jpg)

* 添加打印历史列表，实现任意历史订单快速重印。
 
![](/img/esap12-12.jpg)

## 小结
1. 使用nitro pro转换pdf到EXCEL。

2. 使用VBA扫描EXCEL并调用表间公式(新建表单)批量导入数据。

3. 使用VBA实现批量打印，重复打印。

> 注意：我们通过一个真实案例来展示ES与其他软件的配合使用方案,本文旨在提供一种人力节省方案，阅读和验证本文技术需要一定的VBA基础。
