---
layout: post
title:  "聚慧|全自动先进先出设计"
categories: 日志
tags:  ju 聚表 慧表 先进先出 报表命令 提数
---

* content
{:toc}

本文带你一起用JU来完成ES多年未完成的实用功能——【先进先出】。

## 先看疗效
![](/img/ju5-1.gif)

## 模板
模板有两个sheet,sheet1（doc）包含主表和两个明细，一个【合计明细】，一个【批次明细】。用户只需要操作【主表】和【合计明细】，批次明细自动计算。

![](/img/ju5-2.jpg)

sheet2(ios)是真实的收发明细，映射到收发明细表ios。

![](/img/ju5-3.jpg)

## 提批次库存
用户选择商品，输入合计发货数后，通过提数提取该商品的批次库存，这里主要是对IOS表中该商品的收发数进行合计。

![](/img/ju5-4.jpg)

## 自动配料
通过上面的提数，系统列出当前物料的所有批次库存备用，通过一个简单的公式实现自动配料计算。

![](/img/ju5-5.jpg)

## 配料堆叠
配料大于零的行需要`堆叠`存入sheet2（ios），这里堆叠的意思是，如果sheet2有其他数据了，新数据存放在上方，同商品老数据清除，也是通过一个提数公式实现。

![](/img/ju5-6.jpg)

## 触发时机
报表命令选择在用户输入`合计发货数`后触发，这里有个小bug，输入后需要按tab键，不能按enter键。

![](/img/ju5-7.jpg)

## 小结
* 使用报表命令+提数(手工sql)轻松搞定先进先出这个多年的夙愿。

* 本文涉及的案例已打包成[【六一库(180703)】←点击下载](/files/61data180703.zip)，欢迎下载玩耍。