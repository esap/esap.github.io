---
layout: post
title:  "ESAP第十一弹 通用审核工作流"
categories: esap中级
tags:  勤哲 excelserver 工作流 OA ESAP bug级技术
---

* content
{:toc}

## 概述
以前我们曾演示过工作流的清理技术，实际上是一种事后补救措施。很多客户在设计ES工作流时会直接在表单上设置工作流,这样做看似简单，实际上给后台数据库留下了无穷隐患。研究过数据库Wi表的人会发现，这个表的体积是原表的N倍（N=工作流完成节点数）。

很多时候，我们只是需要某个流程审核通过一下，并不更改数据，这个时候就没有必要在原单据上设置工作流。本次，我们将展示针对审核类ES工作流的进阶设计方案，突破想象。

![](/img/esap11-1.jpg)

## 创建和映射系统表

* 系统表是一种独立的数据库表，它负责记录系统信息，例如，表单的系统ID，表单填报日期，表单状态等。虽然ES有一个类似的系统表RepCase,但却不能为我们所用，所以我们需要另外创建`系统表`。

![](/img/esap11-2.jpg)

* 上图是需要加入审核流程的入库单模板，红框部分就是审核流程需要的信息，我们将其定义为系统表（单一数据项）：`SysRec`。

![](/img/esap11-3.jpg)

> 注意：这里sysid字段我们叠加在了入库单号上。

* 其他模板（如出库单）如需要审核，我们也定义数据项并映射到系统表SysRec。

![](/img/esap11-4.jpg)


## 创建通用审核模板

* 建立一个用于审核的通用模板，这里，我们只定义三个字段：`单号`，`日期`，`结果`。

![](/img/esap11-5.jpg)

* 单号字段设置超链接，模板选择任意映射过系统表的模板（示例为入库单），链接字段选sysid。这样，审核者可以点击查看对应的被审表单。

> 注意：这种对应到系统表字段的超链接可以根据单号打开不同模板的表单。

![](/img/esap11-6.jpg)

* 在审核模板上定义一个节点的工作流。

![](/img/esap11-7.jpg)

## 设置审核

* 在映射系统表的模板上设置表间公式，新建审核表单，并在高级设置中传入审核人(待办人)的名字即可。

![](/img/esap11-8.jpg)

* 设置完成后，新建保存该模板单据时就能产生审核待办事宜！

![](/img/esap11-9.jpg)

## 应用拓展

* 示例中的系统表超链接技术，可以用于数据源模板不同的查询模板，例如进出记录查询。

![](/img/esap11-10.jpg)

> 点击单号的超链接时能查看对应的入库单或出库单。

## 小结

1. 使用（映射）系统表实现多模板超链接技术。

2. 使用通用审核模板的工作流提醒审核者办理。

3. 不在原单据使用工作流将极大减少数据库开支。 