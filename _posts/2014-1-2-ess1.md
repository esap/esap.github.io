---
layout: post
title:  "ES四舍五入的奥义"
categories: es秘籍
tags:  聚表 excel服务器 excelserver
---

* content
{:toc}

## 问题
在做物料需求计算时，我们经常会用到`去尾法`和`进一法`。

例如，一种原料的需求量是1245件，采购时有不同要求：

1. 去掉百位后的尾数，即1200件，如何计算？

2. 自动进位到百位，也就是1300件，如何计算？

3. 要求“三舍四入”到百位，即1300，如何计算？

（不要怀疑`三舍四入`这个概念，这是真实的案例）

## EXCEL公式方案

在EXCEL表格中，我们可以用EXCEL公式来求取这些值，主要涉及公式分别是去尾法（`int`）,进一法（`roundup`）和四舍五入（`round`）。

![](/img/ess1-1.jpg)

## 表间公式方案

使用表间公式也可以实现去尾法和进一法，而这一切只需要一个“四舍五入”的表间公式。

![](/img/ess1-2.jpg)

上面的表间公式方案看起来不可思议，因为表间公式中“四舍五入”的说明实在是太简单了。

![](/img/ess1-3.jpg)

## 探秘

在数据库中，“四舍五入”等价于“round()”，让我们看看round函数的真正诠释：

![](/img/ess1-4.jpg)

在表间公式说明中未指出的第三参数就是一切问题的关键，我们可以简单的认为：

**省略第三参数就是“四舍五入”，第三参数填1时就是去尾函数（INT）**

## 解秘

通过一个简单的表间公式我们就能解答最初提出的问题了

![](/img/ess1-5.jpg) 

同样的，我们完全能够在这基础上轻松得到“`二舍三入`”，“`五舍六入`”等计算方案。

这就是“四舍五入”真正的奥义。