---
layout: post
title:  "聚表版贪吃蛇震撼发布"
categories: 日志
tags:  ju 聚表 贪吃蛇 报表命令
---

* content
{:toc}

本文带你一起来观摩村长的聚表新玩法——小游戏开发

## 先看疗效
![](/img/ju4-1.gif)

## 棋盘
表格上画一个24*24的棋盘，用来供小蛇蛇爬行，右边是`方向按钮`和`启停按钮`（GO/STOP）

![](/img/ju4-2.jpg)

## 主循环
开发过游戏的童鞋应该都知道，游戏一般有个主循环，村长在主表定义了一个RUN字段，类型为整形，作为主循环条件

![](/img/ju4-3.jpg)

在上图中我们可以看到点击`GO`按钮后，RUN赋值为1，同时提数生成一个位置随机的`新豆豆`，然后进入主循环。

下图是主循环流程：

![](/img/ju4-6.jpg)

主要包括：

* 蛇头的前进：x=x+xx,y=y+yy
* 判断吃豆：if(x=ex and y=ey)
* 蛇身跟进:提数`q移动`
* 判断是否挂掉:x,y>24 或者 x,y<0
* 等待300毫秒

## 蛇的移动
主表定义`x`,`y`为蛇头的坐标字段，`xx`,`yy`为蛇的前进向量。

明细定义`x`,`y`为蛇身子的坐标字段，旁边有一个`flag`字段，当flag=1时表示这一截身子是蛇尾，用来控制移动效果。

![](/img/ju4-5.jpg)

提数`q移动`如下：插入新头，舍弃蛇尾。

![](/img/ju4-7.jpg)

## 新豆生产
主表定义`ex`,`ey`为豆豆的坐标字段，类型整形，提数公式`q新豆`定义如下：

![](/img/ju4-4.jpg)

通过直接写sql,利用`cast(ceiling(rand() * 24) as int)`生成1~24之间的随机整数，然后填入到ex，ey即可。

## 吃豆
当蛇头(x,y)与豆豆(ex,ey)重叠时，判断吃豆变长，提数公式`q吃`定义如下：

![](/img/ju4-8.jpg)

实际就是把蛇尾复制一下，这样就`变长了`。

下面是完成后的主循环完整命令截图：

![](/img/ju4-9.jpg)

## 动画显示
这个部分比较简单，设置三种条件格式，根据x,y,ex,ey,明细表的x,y显示不同颜色即可。

![](/img/ju4-10.jpg)

## 小结
* 使用聚表命令，轻松玩转小游戏，更多大开脑洞玩法等着你。

* 本文涉及的案例已打包成[【六一库(180625)】←点击下载](/files/61data180625.zip)，欢迎下载玩耍。